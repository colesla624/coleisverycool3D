<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Crystal Collector 3D</title>
<style>
body { margin:0; overflow:hidden; background:#0b1026; }
#hud {
position:fixed; top:10px; left:50%; transform:translateX(-50%);
color:#e9ecff; font-family:sans-serif; font-size:16px;
text-shadow:0 2px 6px rgba(0,0,0,0.6);
}
#btnJump {
position:fixed; right:20px; bottom:20px;
width:70px; height:70px; border-radius:50%;
background:#202859; color:#e9ecff; font-size:18px;
border:1px solid #4450a8; box-shadow:0 6px 20px rgba(0,0,0,0.4);
touch-action:none;
}
.stick {
position:fixed; bottom:16px; width:120px; height:120px; border-radius:50%;
background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.18);
touch-action:none; backdrop-filter:blur(6px);
}
#stickLeft { left:16px; }
#stickRight { right:120px; }
.knob {
position:absolute; left:50%; top:50%; width:54px; height:54px; border-radius:50%;
transform:translate(-50%,-50%); background:rgba(97,225,255,0.35); border:1px solid rgba(97,225,255,0.6);
}
</style>
</head>
<body>
<div id="hud">Crystals: <span id="score">0</span></div>
<div id="stickLeft" class="stick"><div class="knob"></div></div>
<div id="stickRight" class="stick"><div class="knob"></div></div>
<button id="btnJump">Jump</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
(() => {
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 500);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.HemisphereLight(0x8a5cff, 0x0b1026, 0.7));
const dir = new THREE.DirectionalLight(0xffffff, 0.8);
dir.position.set(20,30,10); scene.add(dir);

// Ground
const ground = new THREE.Mesh(new THREE.BoxGeometry(40,1,40), new THREE.MeshStandardMaterial({color:0x1b2250}));
ground.position.y=-0.5; scene.add(ground);

// Crystals
const crystals=[];
function addCrystal(x,z){
const geo=new THREE.ConeGeometry(0.5,1.5,6);
const mat=new THREE.MeshStandardMaterial({color:0x61e1ff, emissive:0x004466, emissiveIntensity:0.6});
const c=new THREE.Mesh(geo,mat);
c.position.set(x,0.75,z); scene.add(c); crystals.push(c);
}
for(let i=0;i<10;i++) addCrystal((Math.random()-0.5)*30,(Math.random()-0.5)*30);

// Player
const player={pos:new THREE.Vector3(0,1.7,5),vel:new THREE.Vector3(),yaw:0,pitch:0,grounded:false};
camera.position.copy(player.pos);

// Controls
const keys={w:false,a:false,s:false,d:false,space:false};
window.addEventListener("keydown",e=>{if(e.key==="w")keys.w=true;if(e.key==="a")keys.a=true;if(e.key==="s")keys.s=true;if(e.key==="d")keys.d=true;if(e.key===" ")keys.space=true;});
window.addEventListener("keyup",e=>{if(e.key==="w")keys.w=false;if(e.key==="a")keys.a=false;if(e.key==="s")keys.s=false;if(e.key==="d")keys.d=false;if(e.key===" ")keys.space=false;});

// Pointer lock (desktop look)
renderer.domElement.addEventListener("click",()=>{renderer.domElement.requestPointerLock();});
document.addEventListener("mousemove",e=>{
if(document.pointerLockElement){
player.yaw-=e.movementX*0.0025;
player.pitch-=e.movementY*0.002;
player.pitch=Math.max(-Math.PI/2+0.1,Math.min(Math.PI/2-0.1,player.pitch));
}
});

// Touch sticks
let moveStick={x:0,y:0}, lookStick={x:0,y:0};
function setupStick(el,onMove){
const knob=el.querySelector(".knob");
let active=false;
el.addEventListener("touchstart",e=>{active=true;}, {passive:false});
el.addEventListener("touchmove",e=>{
if(!active)return;
const rect=el.getBoundingClientRect();
const t=e.touches[0];
const dx=t.clientX-(rect.left+rect.width/2);
const dy=t.clientY-(rect.top+rect.height/2);
const r=50,mag=Math.hypot(dx,dy),cl=mag>r?r/mag:1;
const nx=dx*cl,ny=dy*cl;
knob.style.transform=`translate(${nx}px,${ny}px) translate(-50%,-50%)`;
onMove(nx/r,ny/r);
e.preventDefault();
}, {passive:false});
el.addEventListener("touchend",()=>{active=false;knob.style.transform="translate(-50%,-50%)";onMove(0,0);});
}
setupStick(document.getElementById("stickLeft"),(x,y)=>{moveStick.x=x;moveStick.y=y;});
setupStick(document.getElementById("stickRight"),(x,y)=>{lookStick.x=x;lookStick.y=y;});

// Jump button
document.getElementById("btnJump").addEventListener("click",()=>{if(player.grounded){player.vel.y=5;player.grounded=false;}});

// Score
let score=0; const scoreEl=document.getElementById("score");

// Loop
function loop(){
const dt=0.016;
// Movement
const speed=6;
let forward=(keys.w?1:0)-(keys.s?1:0)-moveStick.y;
let strafe=(keys.d?1:0)-(keys.a?1:0)+moveStick.x;
const len=Math.hypot(forward,strafe); if(len>1){forward/=len;strafe/=len;}
const cos=Math.cos(player.yaw),sin=Math.sin(player.yaw);
player.pos.x+=(strafe*cos+forward*sin)*speed*dt;
player.pos.z+=(strafe*-sin+forward*cos)*speed*dt;

// Gravity
player.vel.y-=9.8*dt; player.pos.y+=player.vel.y*dt;
if(player.pos.y<1.7){player.pos.y=1.7;player.vel.y=0;player.grounded=true;}

// Look (touch)
player.yaw-=lookStick.x*2.5*dt;
player.pitch-=lookStick.y*2.0*dt;
player.pitch=Math.max(-Math.PI/2+0.1,Math.min(Math.PI/2-0.1,player.pitch));

// Camera
camera.position.copy(player.pos);
camera.rotation.set(player.pitch,player.yaw,0);

// Collect crystals
for(let i=crystals.length-1;i>=0;i--){
if(camera.position.distanceTo(crystals[i].position)<1.5){
scene.remove(crystals[i]); crystals.splice(i,1); score++; scoreEl.textContent=score;
}
}

renderer.render(scene,camera);
requestAnimationFrame(loop);
}
loop();
})();
</script>
</body>
</html>
